can i copy this as it is
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Rescue Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 350px;
            background-color: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo h1 {
            color: #2c3e50;
            font-size: 24px;
        }
        
        .logo p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            background-color: #e9ecef;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab:last-child {
            margin-right: 0;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-card i {
            font-size: 24px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* Impact Metrics */
        .impact-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .impact-container h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .metric {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .metric i {
            font-size: 20px;
            margin-right: 10px;
            color: #2ecc71;
        }
        
        .metric-info {
            flex: 1;
        }
        
        .metric-info h4 {
            font-size: 16px;
            margin-bottom: 2px;
        }
        
        .metric-info p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* Matches List */
        .match-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        
        .match-item h4 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .match-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: normal;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background-color: #cfe2ff;
            color: #084298;
        }
        
        .status-completed {
            background-color: #d1e7dd;
            color: #0f5132;
        }
        
        .match-item p {
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }
        
        .match-item i {
            margin-right: 8px;
            color: #3498db;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
            justify-content: center;
            padding: 10px;
        }
        
        /* Filters */
        .filter-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .filter-container h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
        }
        
        .filter-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* Map Container */
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow: auto;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #2c3e50;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group select[multiple] {
            height: 100px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 4px;
            padding: 15px;
            width: 300px;
            display: none;
            z-index: 1001;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .notification-title {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .notification-close {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #aaa;
        }
        
        .notification-message {
            color: #555;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h1><i class="fas fa-utensils"></i> Food Rescue</h1>
            <p>Connecting surplus food with those in need</p>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="matches">Matches</div>
            <div class="tab" data-tab="stats">Stats</div>
            <div class="tab" data-tab="filters">Filters</div>
        </div>
        
        <!-- Tab Content -->
        <div id="matches" class="tab-content active">
            <div class="action-buttons">
                <button id="autoMatchBtn" class="btn btn-warning">
                    <i class="fas fa-magic"></i> Find Matches
                </button>
            </div>
            
            <div id="matchesList">
                <p>Loading matches...</p>
            </div>
        </div>
        
        <div id="stats" class="tab-content">
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-hand-holding-heart"></i>
                    <h3 id="donorCount">0</h3>
                    <p>Food Donors</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="recipientCount">0</h3>
                    <p>Recipients</p>
                </div>
            </div>
            
            <div class="impact-container">
                <h3>Impact Metrics</h3>
                <div class="metric">
                    <i class="fas fa-weight-hanging"></i>
                    <div class="metric-info">
                        <h4>Food Redirected</h4>
                        <p>From waste to those in need</p>
                    </div>
                    <div class="metric-value" id="foodRedirected">0 kg</div>
                </div>
                <div class="metric">
                    <i class="fas fa-utensils"></i>
                    <div class="metric-info">
                        <h4>Meals Provided</h4>
                        <p>Estimated meals created</p>
                    </div>
                    <div class="metric-value" id="mealsProvided">0</div>
                </div>
                <div class="metric">
                    <i class="fas fa-leaf"></i>
                    <div class="metric-info">
                        <h4>CO2 Saved</h4>
                        <p>Environmental impact</p>
                    </div>
                    <div class="metric-value" id="co2Saved">0 kg</div>
                </div>
            </div>
        </div>
        
        <div id="filters" class="tab-content">
            <div class="filter-container">
                <h3>Filter Options</h3>
                <div class="filter-group">
                    <label for="distanceFilter">Maximum Distance: <span id="distanceValue">10 km</span></label>
                    <input type="range" id="distanceFilter" min="1" max="50" value="10">
                </div>
                <div class="filter-group">
                    <label for="foodTypeFilter">Food Type</label>
                    <select id="foodTypeFilter">
                        <option value="all">All Types</option>
                        <option value="vegetables">Vegetables</option>
                        <option value="fruits">Fruits</option>
                        <option value="grains">Grains</option>
                        <option value="dairy">Dairy</option>
                        <option value="meat">Meat</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="urgencyFilter">Urgency Level</label>
                    <select id="urgencyFilter">
                        <option value="all">All Levels</option>
                        <option value="high">High (Expiring today)</option>
                        <option value="medium">Medium (Expiring in 1-3 days)</option>
                        <option value="low">Low (Expiring in 4+ days)</option>
                    </select>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="addDonorBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Donor
                </button>
                <button id="addRecipientBtn" class="btn btn-success">
                    <i class="fas fa-plus"></i> Add Recipient
                </button>
            </div>
        </div>
    </div>
    
    <!-- Map Container -->
    <div class="map-container">
        <div id="map"></div>
    </div>
    
    <!-- Add Donor Modal -->
    <div id="addDonorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Food Donor</h2>
                <span class="close">&times;</span>
            </div>
            <form id="addDonorForm">
                <div class="form-group">
                    <label for="donorName">Name</label>
                    <input type="text" id="donorName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="donorType">Type</label>
                        <select id="donorType" required>
                            <option value="restaurant">Restaurant</option>
                            <option value="grocery">Grocery Store</option>
                            <option value="farm">Farm</option>
                            <option value="individual">Individual</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="donorFoodType">Food Type</label>
                        <select id="donorFoodType" required>
                            <option value="vegetables">Vegetables</option>
                            <option value="fruits">Fruits</option>
                            <option value="grains">Grains</option>
                            <option value="dairy">Dairy</option>
                            <option value="meat">Meat</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="donorQuantity">Quantity</label>
                        <input type="text" id="donorQuantity" placeholder="e.g., 50kg" required>
                    </div>
                    <div class="form-group">
                        <label for="donorExpiry">Expiry</label>
                        <select id="donorExpiry" required>
                            <option value="today">Today</option>
                            <option value="1day">1 Day</option>
                            <option value="2days">2 Days</option>
                            <option value="3days">3 Days</option>
                            <option value="1week">1 Week</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="donorLat">Latitude</label>
                        <input type="number" id="donorLat" step="0.000001" required>
                    </div>
                    <div class="form-group">
                        <label for="donorLon">Longitude</label>
                        <input type="number" id="donorLon" step="0.000001" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="donorContact">Contact Information</label>
                    <input type="text" id="donorContact" required>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">Add Donor</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Recipient Modal -->
    <div id="addRecipientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Food Recipient</h2>
                <span class="close">&times;</span>
            </div>
            <form id="addRecipientForm">
                <div class="form-group">
                    <label for="recipientName">Name</label>
                    <input type="text" id="recipientName" required>
                </div>
                <div class="form-group">
                    <label for="recipientType">Type</label>
                    <select id="recipientType" required>
                        <option value="shelter">Homeless Shelter</option>
                        <option value="food_bank">Food Bank</option>
                        <option value="community_center">Community Center</option>
                        <option value="school">School</option>
                        <option value="individual">Individual</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="recipientNeed">Need</label>
                        <input type="text" id="recipientNeed" placeholder="e.g., Weekly food supply" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientCapacity">Capacity</label>
                        <input type="text" id="recipientCapacity" placeholder="e.g., 100 meals" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="recipientFoodTypes">Accepted Food Types</label>
                    <select id="recipientFoodTypes" multiple required>
                        <option value="vegetables">Vegetables</option>
                        <option value="fruits">Fruits</option>
                        <option value="grains">Grains</option>
                        <option value="dairy">Dairy</option>
                        <option value="meat">Meat</option>
                        <option value="mixed">Mixed</option>
                    </select>
                    <small>Hold Ctrl/Cmd to select multiple</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="recipientLat">Latitude</label>
                        <input type="number" id="recipientLat" step="0.000001" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientLon">Longitude</label>
                        <input type="number" id="recipientLon" step="0.000001" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="recipientContact">Contact Information</label>
                    <input type="text" id="recipientContact" required>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-success">Add Recipient</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-header">
            <div class="notification-title" id="notificationTitle">Notification</div>
            <button class="notification-close">&times;</button>
        </div>
        <div class="notification-message" id="notificationMessage">Message</div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Initialize map
        let map;
        let donorMarkers = [];
        let recipientMarkers = [];
        let matchLines = [];
        let food_donors = [];
        let food_recipients = [];
        let matches = [];
        
        // Initialize the map
        function initializeMap() {
            // Initialize map
            map = L.map('map').setView([41.8781, -87.6298], 13);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Fetch data and populate map
            fetchData();
        }
        
        // Fetch data from API
        async function fetchData() {
            try {
                // Get donors
                const donorsResponse = await fetch('/api/donors');
                food_donors = await donorsResponse.json();
                
                // Get recipients
                const recipientsResponse = await fetch('/api/recipients');
                food_recipients = await recipientsResponse.json();
                
                // Get existing matches
                const matchesResponse = await fetch('/api/matches');
                matches = await matchesResponse.json();
                
                // Populate map with data
                populateMap();
                
                // Update UI
                updateMatchesList(matches);
                updateImpactMetrics(matches);
                updateStats();
            } catch (error) {
                console.error('Error fetching data:', error);
                showNotification('Error', 'Failed to load data. Please refresh the page.');
            }
        }
        
        // Populate map with markers and lines
        function populateMap() {
            // Clear existing markers and lines
            donorMarkers.forEach(marker => map.removeLayer(marker));
            recipientMarkers.forEach(marker => map.removeLayer(marker));
            matchLines.forEach(line => map.removeLayer(line));
            
            donorMarkers.length = 0;
            recipientMarkers.length = 0;
            matchLines.length = 0;
            
            // Add donor markers
            food_donors.forEach(donor => {
                const marker = L.marker([donor.lat, donor.lon], {
                    icon: L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    })
                }).addTo(map);
                
                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <h3>${donor.name}</h3>
                        <p><strong>Type:</strong> ${donor.type.charAt(0).toUpperCase() + donor.type.slice(1)}</p>
                        <p><strong>Food:</strong> ${donor.food_type.charAt(0).toUpperCase() + donor.food_type.slice(1)}</p>
                        <p><strong>Quantity:</strong> ${donor.quantity}</p>
                        <p><strong>Expiry:</strong> ${formatExpiry(donor.expiry)}</p>
                        <p><strong>Contact:</strong> ${donor.contact}</p>
                    </div>
                `);
                
                donorMarkers.push(marker);
            });
            
            // Add recipient markers
            food_recipients.forEach(recipient => {
                const marker = L.marker([recipient.lat, recipient.lon], {
                    icon: L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    })
                }).addTo(map);
                
                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <h3>${recipient.name}</h3>
                        <p><strong>Type:</strong> ${recipient.type.replace('_', ' ').charAt(0).toUpperCase() + recipient.type.replace('_', ' ').slice(1)}</p>
                        <p><strong>Need:</strong> ${recipient.need}</p>
                        <p><strong>Capacity:</strong> ${recipient.capacity}</p>
                        <p><strong>Preferred Food:</strong> ${formatFoodTypes(recipient.food_types)}</p>
                        <p><strong>Contact:</strong> ${recipient.contact}</p>
                    </div>
                `);
                
                recipientMarkers.push(marker);
            });
            
            // Add match lines
            matches.forEach(match => {
                addMatchLine(match);
            });
        }
        
        // Format expiry time for display
        function formatExpiry(expiry) {
            switch(expiry) {
                case 'today': return 'Expiring today';
                case '1day': return 'Expiring in 1 day';
                case '2days': return 'Expiring in 2 days';
                case '3days': return 'Expiring in 3 days';
                case '1week': return 'Expiring in 1 week';
                default: return expiry;
            }
        }
        
        // Format food types for display
        function formatFoodTypes(types) {
            return types.map(type => type.charAt(0).toUpperCase() + type.slice(1)).join(', ');
        }
        
        // Add a line between donor and recipient
        function addMatchLine(match) {
            const line = L.polyline([
                [match.donor.lat, match.donor.lon],
                [match.recipient.lat, match.recipient.lon]
            ], {
                color: '#2ecc71',
                weight: 3,
                opacity: 0.7,
                dashArray: '5, 10'
            }).addTo(map);
            
            matchLines.push(line);
        }
        
        // Update matches list in sidebar
        function updateMatchesList(matches) {
            const matchesList = document.getElementById('matchesList');
            
            if (matches.length === 0) {
                matchesList.innerHTML = '<p>No matches yet. Click "Find Optimal Matches" to start.</p>';
                return;
            }
            
            matchesList.innerHTML = '';
            
            matches.forEach(match => {
                const matchItem = document.createElement('div');
                matchItem.className = 'match-item';
                matchItem.innerHTML = `
                    <h4>
                        ${match.donor.name} → ${match.recipient.name}
                        <span class="match-status status-${match.status}">${match.status}</span>
                    </h4>
                    <p><i class="fas fa-route"></i> Distance: ${match.distance} km</p>
                    <p><i class="fas fa-utensils"></i> Food: ${match.donor.food_type.charAt(0).toUpperCase() + match.donor.food_type.slice(1)} (${match.donor.quantity})</p>
                    <p><i class="fas fa-clock"></i> Expiry: ${formatExpiry(match.donor.expiry)}</p>
                    <div class="user-actions">
                        <button class="btn btn-small" onclick="confirmMatch(${match.id})">
                            <i class="fas fa-check"></i> Confirm
                        </button>
                        <button class="btn btn-small" onclick="completeMatch(${match.id})">
                            <i class="fas fa-check-double"></i> Complete
                        </button>
                    </div>
                `;
                matchesList.appendChild(matchItem);
            });
        }
        
        // Update impact metrics
        function updateImpactMetrics(matches) {
            let totalFood = 0;
            let totalMeals = 0;
            let totalCO2 = 0;
            
            matches.forEach(match => {
                // Extract numeric value from quantity string (e.g., "50kg" -> 50)
                const quantity = parseFloat(match.donor.quantity);
                if (!isNaN(quantity)) {
                    totalFood += quantity;
                    totalMeals += Math.floor(quantity * 2); // Assume 1kg = 2 meals
                    totalCO2 += quantity * 2.5; // Assume 1kg food waste = 2.5kg CO2
                }
            });
            
            document.getElementById('foodRedirected').textContent = `${totalFood} kg`;
            document.getElementById('mealsProvided').textContent = totalMeals;
            document.getElementById('co2Saved').textContent = `${totalCO2} kg`;
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('donorCount').textContent = food_donors.length;
            document.getElementById('recipientCount').textContent = food_recipients.length;
        }
        
        // Auto-match button functionality
        document.getElementById('autoMatchBtn').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/auto-match');
                const newMatches = await response.json();
                
                // Refresh data
                await fetchData();
                
                // Show notification
                showNotification('Matches Found', `Found ${newMatches.length} new matches!`);
            } catch (error) {
                console.error('Error finding matches:', error);
                showNotification('Error', 'Failed to find matches. Please try again.');
            }
        });
        
        // Confirm a match
        async function confirmMatch(matchId) {
            try {
                const response = await fetch(`/api/match/${matchId}/confirm`, {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    // Refresh data
                    await fetchData();
                    
                    // Show notification
                    showNotification('Match Confirmed', `${result.match.donor.name} → ${result.match.recipient.name} has been confirmed.`);
                } else {
                    showNotification('Error', 'Failed to confirm match. Please try again.');
                }
            } catch (error) {
                console.error('Error confirming match:', error);
                showNotification('Error', 'Failed to confirm match. Please try again.');
            }
        }
        
        // Complete a match
        async function completeMatch(matchId) {
            try {
                const response = await fetch(`/api/match/${matchId}/complete`, {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    // Refresh data
                    await fetchData();
                    
                    // Show notification
                    showNotification('Match Completed', `${result.match.donor.name} → ${result.match.recipient.name} has been completed. Thank you!`);
                } else {
                    showNotification('Error', 'Failed to complete match. Please try again.');
                }
            } catch (error) {
                console.error('Error completing match:', error);
                showNotification('Error', 'Failed to complete match. Please try again.');
            }
        }
        
        // Show notification
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding content
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Distance filter
        document.getElementById('distanceFilter').addEventListener('input', function() {
            document.getElementById('distanceValue').textContent = this.value + ' km';
        });
        
        // Modal functionality
        const modals = document.querySelectorAll('.modal');
        const addDonorBtn = document.getElementById('addDonorBtn');
        const addRecipientBtn = document.getElementById('addRecipientBtn');
        const addDonorModal = document.getElementById('addDonorModal');
        const addRecipientModal = document.getElementById('addRecipientModal');
        
        addDonorBtn.onclick = function() {
            addDonorModal.style.display = 'block';
        }
        
        addRecipientBtn.onclick = function() {
            addRecipientModal.style.display = 'block';
        }
        
        // Close modal when clicking on <span> (x)
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.onclick = function() {
                modals.forEach(modal => modal.style.display = 'none');
            }
        });
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Handle donor form submission
        document.getElementById('addDonorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const newDonor = {
                name: document.getElementById('donorName').value,
                type: document.getElementById('donorType').value,
                lat: parseFloat(document.getElementById('donorLat').value),
                lon: parseFloat(document.getElementById('donorLon').value),
                food_type: document.getElementById('donorFoodType').value,
                quantity: document.getElementById('donorQuantity').value,
                expiry: document.getElementById('donorExpiry').value,
                contact: document.getElementById('donorContact').value
            };
            
            try {
                const response = await fetch('/api/donor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newDonor)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Refresh data
                    await fetchData();
                    
                    // Close modal
                    addDonorModal.style.display = 'none';
                    this.reset();
                    
                    // Show notification
                    showNotification('Donor Added', `${result.donor.name} has been added to the system.`);
                } else {
                    showNotification('Error', 'Failed to add donor. Please try again.');
                }
            } catch (error) {
                console.error('Error adding donor:', error);
                showNotification('Error', 'Failed to add donor. Please try again.');
            }
        });
        
        // Handle recipient form submission
        document.getElementById('addRecipientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const foodTypesSelect = document.getElementById('recipientFoodTypes');
            const selectedFoodTypes = Array.from(foodTypesSelect.selectedOptions).map(option => option.value);
            
            const newRecipient = {
                name: document.getElementById('recipientName').value,
                type: document.getElementById('recipientType').value,
                lat: parseFloat(document.getElementById('recipientLat').value),
                lon: parseFloat(document.getElementById('recipientLon').value),
                need: document.getElementById('recipientNeed').value,
                capacity: document.getElementById('recipientCapacity').value,
                food_types: selectedFoodTypes.length > 0 ? selectedFoodTypes : ['mixed'],
                contact: document.getElementById('recipientContact').value
            };
            
            try {
                const response = await fetch('/api/recipient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newRecipient)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Refresh data
                    await fetchData();
                    
                    // Close modal
                    addRecipientModal.style.display = 'none';
                    this.reset();
                    
                    // Show notification
                    showNotification('Recipient Added', `${result.recipient.name} has been added to the system.`);
                } else {
                    showNotification('Error', 'Failed to add recipient. Please try again.');
                }
            } catch (error) {
                console.error('Error adding recipient:', error);
                showNotification('Error', 'Failed to add recipient. Please try again.');
            }
        });
        
        // Notification close button
        document.querySelector('.notification-close').addEventListener('click', function() {
            document.getElementById('notification').classList.remove('show');
        });
        
        // Initialize the map when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
        });
    </script>
</body>
</html>